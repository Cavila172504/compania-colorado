<div class="p-8 space-y-8 fade-in">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
        <div>
            <h1 class="text-4xl font-black text-white tracking-tight">Consolidado Mensual</h1>
            <p class="text-slate-400 mt-1 font-medium italic">Resumen de todas las rutas y conductores â€¢ Colorado
                Express</p>
        </div>

        <div class="flex flex-wrap items-center gap-3">
            <div class="flex items-center gap-2 bg-slate-900 border border-white/5 p-1 rounded-2xl">
                <div class="flex items-center gap-2 px-4 py-2 bg-slate-950 rounded-xl border border-white/5">
                    <span class="text-[0.6rem] font-black text-slate-500 uppercase tracking-widest">Mes</span>
                    <select [(ngModel)]="mes" (change)="loadConsolidado()"
                        class="bg-transparent text-white font-black outline-none cursor-pointer appearance-none">
                        <option [value]="1">Enero</option>
                        <option [value]="2">Febrero</option>
                        <option [value]="3">Marzo</option>
                        <option [value]="4">Abril</option>
                        <option [value]="5">Mayo</option>
                        <option [value]="6">Junio</option>
                        <option [value]="7">Julio</option>
                        <option [value]="8">Agosto</option>
                        <option [value]="9">Septiembre</option>
                        <option [value]="10">Octubre</option>
                        <option [value]="11">Noviembre</option>
                        <option [value]="12">Diciembre</option>
                    </select>
                </div>
                <div class="flex items-center gap-2 px-4 py-2 bg-slate-950 rounded-xl border border-white/5">
                    <span class="text-[0.6rem] font-black text-slate-500 uppercase tracking-widest">AÃ±o</span>
                    <input type="number" [(ngModel)]="anio" (change)="loadConsolidado()"
                        class="bg-transparent text-white font-black w-16 outline-none">
                </div>
            </div>

            <button (click)="exportToExcel()" class="btn-secondary group">
                <span class="text-xl group-hover:scale-110 transition-transform">ðŸ“Š</span>
                Exportar Excel
            </button>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 slide-up">
        <div class="glass-card p-10 bg-gradient-to-br from-blue-600/5 to-transparent relative overflow-hidden group">
            <div class="absolute -right-6 -bottom-6 text-7xl opacity-[0.03] group-hover:scale-110 transition-transform">
                ðŸ’°</div>
            <span class="text-[0.65rem] font-black text-slate-500 uppercase tracking-[0.2em] block mb-2">Total
                Ingresos</span>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-black text-emerald-400 tracking-tighter">{{getTotalIngresos() |
                    currency}}</span>
                <span class="text-[10px] text-slate-500 font-bold uppercase">FacturaciÃ³n</span>
            </div>
        </div>
        <div class="glass-card p-10 bg-gradient-to-br from-red-600/5 to-transparent relative overflow-hidden group">
            <div class="absolute -right-6 -bottom-6 text-7xl opacity-[0.03] group-hover:scale-110 transition-transform">
                ðŸ“‰</div>
            <span class="text-[0.65rem] font-black text-slate-500 uppercase tracking-[0.2em] block mb-2">Total
                Egresos</span>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-black text-red-400 tracking-tighter">{{getTotalEgresos() | currency}}</span>
                <span class="text-[10px] text-slate-500 font-bold uppercase">Deducciones</span>
            </div>
        </div>
        <div
            class="glass-card p-10 bg-gradient-to-br from-blue-500/20 to-blue-600/5 relative overflow-hidden group border-blue-500/10">
            <div class="absolute -right-6 -bottom-6 text-7xl opacity-[0.1] group-hover:scale-110 transition-transform">
                ðŸ’Ž</div>
            <span class="text-[0.65rem] font-black text-blue-500 uppercase tracking-[0.2em] block mb-2">Total a
                Liquidar</span>
            <div class="flex items-baseline gap-2">
                <span class="text-4xl font-black text-white tracking-tighter">{{getTotalPagar() | currency}}</span>
                <span class="text-[10px] text-blue-500 font-bold uppercase">Saldo Neto</span>
            </div>
        </div>
    </div>

    <!-- Table Card -->
    <div class="glass-card overflow-hidden slide-up" style="animation-delay: 0.1s;">
        <div class="overflow-x-auto">
            <table class="w-full text-left border-collapse">
                <thead>
                    <tr class="bg-white/5 border-b border-white/5">
                        <th
                            class="p-4 text-[0.6rem] font-black text-slate-500 uppercase tracking-[0.1em] whitespace-nowrap">
                            Conductor</th>
                        <th
                            class="p-4 text-[0.6rem] font-black text-slate-500 uppercase tracking-[0.1em] whitespace-nowrap">
                            Ingresos</th>

                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center border-l border-white/5 whitespace-nowrap"
                            title="Cuota Administrativa">C. Admin</th>
                        <th
                            class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap">
                            Renta 1%</th>
                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap"
                            title="ComisiÃ³n CADE">CADE</th>
                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap"
                            title="Anticipo a Socio">Anticipo</th>
                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap"
                            title="Abono de prÃ©stamo">PrÃ©stamo</th>
                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap"
                            title="Aplicativo Mi buseta">Mi Buseta</th>
                        <th class="p-4 text-[0.55rem] font-black text-red-500/70 uppercase tracking-[0.1em] text-center whitespace-nowrap"
                            title="ComisiÃ³n CompaÃ±Ã­a">Com. CÃ­a</th>

                        <th
                            class="p-4 text-[0.6rem] font-black text-red-500 uppercase tracking-[0.1em] text-center border-l border-white/5 whitespace-nowrap">
                            Tot. Egresos</th>
                        <th
                            class="p-4 text-[0.6rem] font-black text-blue-500 uppercase tracking-[0.1em] bg-blue-500/5 border-l border-white/5 whitespace-nowrap">
                            Neto a Recibir</th>
                        <th
                            class="p-4 text-center text-[0.6rem] font-black text-slate-500 uppercase tracking-[0.1em] whitespace-nowrap">
                            Rol</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    <!-- Loading State -->
                    <tr *ngIf="loading">
                        <td colspan="12" class="p-20 text-center">
                            <div class="flex flex-col items-center gap-4">
                                <span class="text-4xl animate-spin">âŒ›</span>
                                <p class="text-slate-500 font-black uppercase tracking-widest text-xs">Cargando
                                    contabilidad...</p>
                            </div>
                        </td>
                    </tr>

                    <!-- Data Rows -->
                    <tr *ngFor="let f of flujos" class="hover:bg-white/[0.02] transition-colors group">
                        <td class="p-4">
                            <div
                                class="font-black text-sm text-white group-hover:text-blue-400 transition-colors uppercase tracking-tight whitespace-nowrap">
                                {{f.conductor_nombre}}</div>
                            <div class="text-[0.6rem] font-bold text-slate-500 uppercase tracking-widest mt-1">Conductor
                                Registrado</div>
                        </td>
                        <td class="p-4 font-black text-emerald-400 text-sm tabular-nums whitespace-nowrap">
                            {{f.total_ingresos | currency}}</td>

                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums border-l border-white/5">
                            {{(f.cuota_administrativa || 0) | currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.renta_1pct || 0) |
                            currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.comision_cade || 0) |
                            currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.anticipo_socio || 0) |
                            currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.abono_prestamo || 0) |
                            currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.aplicativo_buseta || 0) |
                            currency}}</td>
                        <td class="p-4 text-center text-red-300/80 text-xs tabular-nums">{{(f.comision_compania || 0) |
                            currency}}</td>

                        <td
                            class="p-4 text-center font-bold text-red-400 text-sm tabular-nums border-l border-white/5 whitespace-nowrap">
                            {{f.total_egresos | currency}}</td>

                        <td
                            class="p-4 font-black text-white text-base bg-blue-500/5 tabular-nums border-l border-white/5 whitespace-nowrap">
                            {{f.total_recibir | currency}}</td>

                        <td class="p-4 text-center">
                            <div class="flex items-center justify-center gap-1">
                                <button (click)="openChequeModal(f)" title="Registrar Cheque"
                                    class="w-8 h-8 rounded-lg bg-slate-900 border border-white/5 flex items-center justify-center hover:bg-green-600 hover:text-white transition-all shadow-lg active:scale-90 mx-auto group/btn"
                                    [class.bg-green-600]="f.nro_cheque" [class.text-white]="f.nro_cheque"
                                    [class.text-green-400]="!f.nro_cheque">
                                    <span class="text-sm group-hover/btn:scale-110 transition-transform">ðŸ§¾</span>
                                </button>
                                <button (click)="printRol(f)" title="Imprimir Rol"
                                    class="w-8 h-8 rounded-lg bg-slate-900 border border-white/5 text-blue-400 flex items-center justify-center hover:bg-blue-600 hover:text-white transition-all shadow-lg active:scale-90 mx-auto group/btn">
                                    <span class="text-sm group-hover/btn:scale-110 transition-transform">ðŸ“„</span>
                                </button>
                            </div>
                            <div *ngIf="f.nro_cheque" class="text-[0.55rem] font-black text-green-400 mt-1 uppercase">CH
                                #{{f.nro_cheque}}</div>
                        </td>
                    </tr>

                    <!-- Empty State -->
                    <tr *ngIf="flujos.length === 0 && !loading">
                        <td colspan="12" class="p-32 text-center">
                            <div class="opacity-20 flex flex-col items-center gap-6">
                                <span class="text-8xl">ðŸ““</span>
                                <div>
                                    <h3 class="text-2xl font-black text-white uppercase tracking-widest">Sin registros
                                        contables</h3>
                                    <p class="text-slate-500 font-bold mt-2 italic">AÃºn no hay ingresos procesados para
                                        el periodo {{mes}}/{{anio}}</p>
                                </div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Cheque Modal -->
    <div *ngIf="showChequeModal" class="fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md fade-in" (click)="closeChequeModal()"></div>
        <div (click)="$event.stopPropagation()"
            class="relative z-50 w-full max-w-md glass-card border-white/10 overflow-hidden shadow-2xl slide-up">
            <div class="p-6 border-b border-white/5 flex items-center justify-between bg-white/[0.02]">
                <div>
                    <h2 class="text-xl font-black text-white leading-none">Registrar Pago con Cheque</h2>
                    <p class="text-slate-500 text-[0.6rem] font-bold uppercase mt-2 tracking-[0.2em]">
                        {{selectedFlujo?.conductor_nombre}}</p>
                </div>
                <button (click)="closeChequeModal()"
                    class="text-slate-500 hover:text-white transition-colors text-2xl">&times;</button>
            </div>
            <div class="p-8 space-y-6">
                <div class="space-y-3">
                    <label class="text-[0.65rem] font-black text-slate-500 uppercase tracking-widest px-1">NÃºmero de
                        Cheque</label>
                    <input type="text" [(ngModel)]="nroChequeInput" placeholder="Ej: 001234"
                        class="w-full bg-slate-950 border border-white/10 rounded-2xl px-5 py-4 text-white text-xl font-black focus:border-green-500 focus:ring-4 focus:ring-green-500/10 outline-none transition-all"
                        autocomplete="off">
                </div>
                <div class="bg-green-500/5 border border-green-500/10 rounded-2xl p-4 flex items-center gap-3"
                    *ngIf="selectedFlujo">
                    <span class="text-2xl">ðŸ’°</span>
                    <div>
                        <div class="text-[0.6rem] font-black text-green-500 uppercase tracking-widest">Monto a pagar
                        </div>
                        <div class="text-xl font-black text-white">{{selectedFlujo.total_recibir | currency:'USD'}}
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-white/5 flex justify-end gap-4 bg-white/[0.01]">
                <button (click)="closeChequeModal()" class="btn-secondary px-6">Cancelar</button>
                <button (click)="saveCheque()"
                    class="bg-green-600 hover:bg-green-500 text-white px-8 py-3 rounded-xl font-black text-sm transition-all active:scale-95 flex items-center gap-2">
                    ðŸ§¾ {{ nroChequeInput ? 'Guardar Cheque' : 'Quitar Cheque' }}
                </button>
            </div>
        </div>
    </div>
</div>